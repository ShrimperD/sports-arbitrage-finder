<!DOCTYPE html>
<html>
<head>
    <title>Sports Arbitrage Finder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .card { @apply bg-white rounded-lg shadow p-4; }
        .button { @apply bg-blue-500 text-white px-3 py-1.5 rounded text-sm hover:bg-blue-600; }
        .input { @apply border rounded px-2 py-1.5 text-sm; }
        .label { @apply block text-xs font-medium text-gray-700 mb-1; }
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            align-items: end;
        }
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #f3f4f6;
            padding: 0.5rem;
        }
        /* Mobile-friendly styles */
        @media (max-width: 768px) {
            .sticky-header {
                position: relative;
                padding: 0.25rem;
            }
            .card {
                padding: 0.75rem;
            }
            .grid {
                gap: 0.5rem;
            }
            .text-2xl {
                font-size: 1.25rem;
            }
            .settings-grid {
                grid-template-columns: 1fr;
            }
            .opportunity-card {
                padding: 0.75rem;
            }
            .opportunity-card .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-7xl mx-auto px-4">
        <div class="sticky-header">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                <h1 class="text-2xl font-bold mb-2 md:mb-0">Sports Arbitrage Finder</h1>
                <div class="text-xs text-gray-600">
                    <span>API: </span>
                    <span>Requests: <span id="requestsRemaining">-</span> | </span>
                    <span>Updated: <span id="lastUpdated">Never</span></span>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
                <!-- Arbitrage Calculator - 3 columns -->
                <div class="col-span-1 md:col-span-3">
                    <div class="card h-full">
                        <h2 class="text-sm font-bold mb-2">Arbitrage Calculator</h2>
                        <div class="space-y-2">
                            <div>
                                <label class="label">Odds 1 (American)</label>
                                <input type="number" class="input w-full" id="odds1" placeholder="+150">
                            </div>
                            <div>
                                <label class="label">Odds 2 (American)</label>
                                <input type="number" class="input w-full" id="odds2" placeholder="-130">
                            </div>
                            <div>
                                <label class="label">Total Stake ($)</label>
                                <input type="number" class="input w-full" id="calcStake" value="100">
                            </div>
                            <div id="calculatorResult" class="mt-3 p-2 bg-gray-50 rounded">
                                <div class="grid grid-cols-2 gap-2 text-xs">
                                    <div>
                                        <p class="text-gray-600">Total Stake:</p>
                                        <p class="font-medium" id="totalStakeDisplay">$0.00</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-gray-600">Total Payout:</p>
                                        <p class="font-medium" id="totalPayoutDisplay">$0.00</p>
                                    </div>
                                    <div class="col-span-2 text-center">
                                        <p class="text-gray-600">Profit:</p>
                                        <p class="font-medium text-green-600" id="profitDisplay">$0.00 (0.00%)</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings - 9 columns -->
                <div class="col-span-1 md:col-span-9">
                    <div class="card">
                        <div class="grid grid-cols-2 md:grid-cols-6 gap-3">
                            <div class="col-span-1 md:col-span-1">
                                <label class="label">Sport</label>
                                <select class="input w-full text-sm" id="sportSelect">
                                    <option value="all">All Sports</option>
                                </select>
                            </div>
                            <div class="col-span-1 md:col-span-1">
                                <label class="label">Min Return (%)</label>
                                <input type="number" class="input w-full" id="minReturn" value="0.5" min="0" step="0.1">
                            </div>
                            <div class="col-span-1 md:col-span-1">
                                <label class="label">Max Stake ($)</label>
                                <input type="number" class="input w-full" id="maxStake" value="100" min="100" step="100">
                            </div>
                            <div class="col-span-1 md:col-span-1">
                                <label class="label">Min Profit ($)</label>
                                <input type="number" class="input w-full" id="minProfit" value="20" min="0" step="1">
                            </div>
                            <div class="col-span-1 md:col-span-1">
                                <label class="label">Sort By</label>
                                <select class="input w-full text-sm" id="sortSelect">
                                    <option value="time">Game Time</option>
                                    <option value="return">Return % (High-Low)</option>
                                    <option value="profit">Profit $ (High-Low)</option>
                                </select>
                            </div>
                            <div class="col-span-1 md:col-span-1 flex items-center">
                                <label class="inline-flex items-center">
                                    <input type="checkbox" id="autoRefresh" class="form-checkbox h-4 w-4">
                                    <span class="ml-1 text-xs">Auto Refresh</span>
                                </label>
                            </div>
                        </div>

                        <!-- Bookmakers as tags -->
                        <div class="mt-3">
                            <label class="label mb-1">Bookmakers</label>
                            <div id="bookmakerFilters" class="flex flex-wrap gap-1">
                                <!-- Bookmaker buttons will be added here -->
                            </div>
                            <div class="mt-1">
                                <button onclick="selectAllBookmakers(true)" class="text-xs text-blue-600 hover:underline">Select All</button>
                                <span class="text-gray-300 mx-1">|</span>
                                <button onclick="selectAllBookmakers(false)" class="text-xs text-blue-600 hover:underline">Deselect All</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <h2 class="text-lg font-bold mb-4">Live Opportunities</h2>
            <div id="opportunities" class="space-y-3">
                <div class="text-center text-gray-500 py-4">
                    Select a sport to view opportunities
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '4a0183ff75bc6a57c88422076c0f350b';
        const BASE_URL = 'https://api.the-odds-api.com/v4/sports';
        let opportunities = [];
        let allSports = [];
        let sportOpportunities = new Map();
        let bookmakers = new Set();
        let selectedBookmakers = new Set();

        // Load saved bookmaker selections from localStorage
        function loadSavedBookmakers() {
            const saved = localStorage.getItem('selectedBookmakers');
            if (saved) {
                selectedBookmakers = new Set(JSON.parse(saved));
            }
        }

        function updateBookmakerFilters() {
            const container = document.getElementById('bookmakerFilters');
            const sortedBookmakers = Array.from(bookmakers).sort();
            
            if (selectedBookmakers.size === 0 && !localStorage.getItem('selectedBookmakers')) {
                sortedBookmakers.forEach(b => selectedBookmakers.add(b));
            }
            
            container.innerHTML = sortedBookmakers.map(bookmaker => `
                <div class="inline-flex items-center">
                    <input type="checkbox" 
                           id="bookmaker-${bookmaker.replace(/\s+/g, '-')}" 
                           value="${bookmaker}"
                           ${selectedBookmakers.has(bookmaker) ? 'checked' : ''}
                           class="form-checkbox h-3 w-3"
                           onchange="toggleBookmaker('${bookmaker}')"
                    >
                    <label for="bookmaker-${bookmaker.replace(/\s+/g, '-')}" class="ml-1 text-xs">
                        ${bookmaker}
                    </label>
                </div>
            `).join('');
        }

        function toggleBookmaker(bookmaker) {
            if (selectedBookmakers.has(bookmaker)) {
                selectedBookmakers.delete(bookmaker);
            } else {
                selectedBookmakers.add(bookmaker);
            }
            localStorage.setItem('selectedBookmakers', JSON.stringify(Array.from(selectedBookmakers)));
            updateBookmakerFilters();
            // Update opportunities immediately when bookmakers are toggled
            updateOpportunities();
        }

        function selectAllBookmakers(select) {
            if (select) {
                bookmakers.forEach(b => selectedBookmakers.add(b));
            } else {
                selectedBookmakers.clear();
            }
            localStorage.setItem('selectedBookmakers', JSON.stringify(Array.from(selectedBookmakers)));
            updateBookmakerFilters();
            // Update opportunities immediately when bookmakers are toggled
            updateOpportunities();
        }

        function updateSportCounts() {
            // Reset all counts
            sportOpportunities.clear();
            sportOpportunities.set('all', 0);
            
            // Count opportunities for each sport
            opportunities.forEach(opp => {
                const sport = opp.sport;
                sportOpportunities.set(sport, (sportOpportunities.get(sport) || 0) + 1);
                sportOpportunities.set('all', sportOpportunities.get('all') + 1);
            });

            // Update the dropdown options
            const select = document.getElementById('sportSelect');
            const selectedValue = select.value;
            
            // Update "All Sports" count
            select.options[0].textContent = `All Sports (${sportOpportunities.get('all') || 0})`;
            
            // Update other sports counts
            for (let i = 1; i < select.options.length; i++) {
                const option = select.options[i];
                const sport = allSports.find(s => s.key === option.value);
                if (sport) {
                    const count = sportOpportunities.get(sport.title) || 0;
                    option.textContent = `${sport.title} (${count})`;
                }
            }

            // Restore selected value
            select.value = selectedValue;
        }

        async function fetchSports() {
            try {
                console.log('Fetching sports...');
                const response = await fetch(`${BASE_URL}?apiKey=${API_KEY}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const sports = await response.json();
                console.log('Sports fetched:', sports);
                allSports = sports;
                const select = document.getElementById('sportSelect');
                
                // Clear existing options except "All Sports"
                select.innerHTML = '<option value="all">All Sports (0)</option>';
                
                sports.forEach(sport => {
                    const option = document.createElement('option');
                    option.value = sport.key;
                    option.textContent = `${sport.title} (0)`;
                    select.appendChild(option);
                });

                updateRequestsRemaining(response.headers);
                
                // Initial load of all sports data
                updateOpportunities();
            } catch (error) {
                console.error('Error fetching sports:', error);
                document.getElementById('opportunities').innerHTML = `
                    <div class="text-center text-red-500 py-4">
                        Error fetching sports: ${error.message}
                    </div>
                `;
            }
        }

        async function fetchOdds(sportKey) {
            try {
                console.log(`Fetching odds for ${sportKey}...`);
                const response = await fetch(
                    `${BASE_URL}/${sportKey}/odds?apiKey=${API_KEY}&regions=us&markets=h2h`
                );
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const events = await response.json();
                console.log(`Odds fetched for ${sportKey}:`, events);
                updateRequestsRemaining(response.headers);
                return events;
            } catch (error) {
                console.error(`Error fetching odds for ${sportKey}:`, error);
                return [];
            }
        }

        async function fetchAllSportsOdds() {
            try {
                // Use Promise.all to fetch all sports concurrently
                const promises = allSports.map(sport => 
                    fetchOdds(sport.key)
                        .then(events => events.map(event => ({ ...event, sport: sport.title })))
                        .catch(error => {
                            console.error(`Error fetching odds for ${sport.title}:`, error);
                            return []; // Return empty array on error to continue with other sports
                        })
                );
                
                const results = await Promise.all(promises);
                return results.flat(); // Combine all events into a single array
            } catch (error) {
                console.error('Error fetching all sports odds:', error);
                return [];
            }
        }

        function formatGameTime(isoString) {
            const date = new Date(isoString);
            // Convert to Central Time
            const cstDate = new Date(date.toLocaleString('en-US', { timeZone: 'America/Chicago' }));
            
            // Format date and time
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            let dateStr;
            if (cstDate.toDateString() === today.toDateString()) {
                dateStr = 'Today';
            } else if (cstDate.toDateString() === tomorrow.toDateString()) {
                dateStr = 'Tomorrow';
            } else {
                dateStr = cstDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            }
            
            // Format time in 12-hour format
            const timeStr = cstDate.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit', 
                hour12: true 
            });
            
            return `${dateStr} ${timeStr} CST`;
        }

        function findArbitrageOpportunities(events) {
            console.log('Processing events:', events);
            // First, update our bookmakers set with any new bookmakers
            events.forEach(event => {
                if (event.bookmakers) {
                    event.bookmakers.forEach(b => {
                        if (b.title) {
                            bookmakers.add(b.title);
                            // Add to selected bookmakers if it's new
                            if (!selectedBookmakers.has(b.title)) {
                                selectedBookmakers.add(b.title);
                            }
                        }
                    });
                }
            });
            
            console.log('Available bookmakers:', Array.from(bookmakers));
            console.log('Selected bookmakers:', Array.from(selectedBookmakers));
            
            // Update the bookmaker filter buttons
            updateBookmakerFilters();

            const opportunities = [];
            const minReturn = parseFloat(document.getElementById('minReturn').value) || 0.5;
            const maxStake = parseFloat(document.getElementById('maxStake').value) || 100;

            events.forEach(event => {
                // Filter bookmakers based on selection
                const filteredBookmakers = event.bookmakers?.filter(b => selectedBookmakers.has(b.title)) || [];
                if (!filteredBookmakers || filteredBookmakers.length < 2) return;

                const bestOdds = {
                    home: { odds: 0, bookmaker: '' },
                    away: { odds: 0, bookmaker: '' }
                };

                filteredBookmakers.forEach(bookmaker => {
                    const market = bookmaker.markets.find(m => m.key === 'h2h');
                    if (!market) return;

                    const homeOdds = market.outcomes.find(o => o.name === event.home_team)?.price;
                    const awayOdds = market.outcomes.find(o => o.name === event.away_team)?.price;

                    if (homeOdds && homeOdds > bestOdds.home.odds) {
                        bestOdds.home = { odds: homeOdds, bookmaker: bookmaker.title };
                    }
                    if (awayOdds && awayOdds > bestOdds.away.odds) {
                        bestOdds.away = { odds: awayOdds, bookmaker: bookmaker.title };
                    }
                });

                const impliedProbHome = 1 / bestOdds.home.odds;
                const impliedProbAway = 1 / bestOdds.away.odds;
                const totalImpliedProb = impliedProbHome + impliedProbAway;

                if (totalImpliedProb < 1) {
                    const returnPercentage = ((1 / totalImpliedProb) - 1) * 100;
                    if (returnPercentage >= minReturn) {
                        const totalStake = maxStake;
                        // Round stakes to whole numbers
                        const homeStake = Math.round(totalStake * impliedProbHome / totalImpliedProb);
                        const awayStake = Math.round(totalStake * impliedProbAway / totalImpliedProb);

                        // Adjust stakes to ensure total is exactly maxStake
                        const totalCalculatedStake = homeStake + awayStake;
                        let adjustedHomeStake = homeStake;
                        let adjustedAwayStake = awayStake;
                        
                        if (totalCalculatedStake !== totalStake) {
                            // Add or subtract the difference from the larger stake
                            const difference = totalStake - totalCalculatedStake;
                            if (homeStake > awayStake) {
                                adjustedHomeStake = homeStake + difference;
                            } else {
                                adjustedAwayStake = awayStake + difference;
                            }
                        }

                        opportunities.push({
                            homeTeam: event.home_team,
                            awayTeam: event.away_team,
                            sport: event.sport || 'Unknown',
                            return: returnPercentage,
                            commenceTime: event.commence_time,
                            bets: [
                                {
                                    team: event.home_team,
                                    odds: bestOdds.home.odds,
                                    bookmaker: bestOdds.home.bookmaker,
                                    stake: adjustedHomeStake
                                },
                                {
                                    team: event.away_team,
                                    odds: bestOdds.away.odds,
                                    bookmaker: bestOdds.away.bookmaker,
                                    stake: adjustedAwayStake
                                }
                            ]
                        });
                    }
                }
            });

            // Sort opportunities by game time
            return opportunities.sort((a, b) => new Date(a.commenceTime) - new Date(b.commenceTime));
        }

        function updateRequestsRemaining(headers) {
            const remaining = headers.get('x-requests-remaining');
            document.getElementById('requestsRemaining').textContent = remaining || 'Unknown';
            document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
        }

        function sortOpportunities(opportunities, sortBy) {
            const minProfit = parseFloat(document.getElementById('minProfit').value) || 0;
            const maxStake = parseFloat(document.getElementById('maxStake').value) || 100;

            // Filter by minimum profit first
            opportunities = opportunities.filter(opp => 
                (opp.return * maxStake / 100) >= minProfit
            );

            switch (sortBy) {
                case 'return':
                    return opportunities.sort((a, b) => b.return - a.return);
                case 'profit':
                    return opportunities.sort((a, b) => {
                        const profitA = (a.return * maxStake / 100);
                        const profitB = (b.return * maxStake / 100);
                        return profitB - profitA;
                    });
                case 'time':
                default:
                    return opportunities.sort((a, b) => new Date(a.commenceTime) - new Date(b.commenceTime));
            }
        }

        function convertDecimalToAmerican(decimal) {
            if (decimal >= 2) {
                return Math.round((decimal - 1) * 100);
            } else {
                return Math.round(-100 / (decimal - 1));
            }
        }

        function convertDecimalToFractional(decimal) {
            const tolerance = 1.0E-6;
            let h1 = 1;
            let h2 = 0;
            let k1 = 0;
            let k2 = 1;
            let b = decimal;
            do {
                let a = Math.floor(b);
                let aux = h1;
                h1 = a * h1 + h2;
                h2 = aux;
                aux = k1;
                k1 = a * k1 + k2;
                k2 = aux;
                b = 1 / (b - a);
            } while (Math.abs(decimal - h1 / k1) > decimal * tolerance);
            return `${h1}/${k1}`;
        }

        function formatOdds(decimal) {
            const american = convertDecimalToAmerican(decimal);
            const fractional = convertDecimalToFractional(decimal);
            return {
                decimal: decimal.toFixed(2),
                american: american > 0 ? `+${american}` : american.toString(),
                fractional: fractional
            };
        }

        function displayOpportunities() {
            const container = document.getElementById('opportunities');
            
            // Update sport counts first
            updateSportCounts();
            
            if (opportunities.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-4">
                        No arbitrage opportunities found for the selected sport
                    </div>
                `;
                return;
            }

            // Sort opportunities based on selected criteria
            const sortBy = document.getElementById('sortSelect').value;
            const sortedOpportunities = sortOpportunities([...opportunities], sortBy);

            // Create a grid container for the opportunities
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${sortedOpportunities.map(opp => {
                        const odds1 = formatOdds(opp.bets[0].odds);
                        const odds2 = formatOdds(opp.bets[1].odds);
                        return `
                            <div class="opportunity-card border rounded p-3 bg-white shadow-sm">
                                <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                                    <div class="flex-1">
                                        <h3 class="font-bold text-sm">${opp.homeTeam} vs ${opp.awayTeam}</h3>
                                        <div class="flex flex-wrap items-center gap-2 text-xs text-gray-600 mt-1">
                                            <span>${opp.sport}</span>
                                            <span>•</span>
                                            <span>${formatGameTime(opp.commenceTime)}</span>
                                        </div>
                                    </div>
                                    <div class="text-right mt-2 md:mt-0">
                                        <p class="font-bold text-green-500 text-sm">${opp.return.toFixed(2)}%</p>
                                        <p class="text-xs text-green-600">$${(opp.return * parseFloat(document.getElementById('maxStake').value) / 100).toFixed(2)}</p>
                                    </div>
                                </div>
                                <div class="mt-2 space-y-2">
                                    ${opp.bets.map((bet, index) => {
                                        const odds = index === 0 ? odds1 : odds2;
                                        return `
                                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-t pt-2">
                                                <div>
                                                    <p class="text-sm font-medium">${bet.team}</p>
                                                    <p class="text-xs text-gray-600">${bet.bookmaker}</p>
                                                </div>
                                                <div class="text-right mt-1 md:mt-0">
                                                    <p class="text-sm font-medium">$${parseFloat(bet.stake).toFixed(2)}</p>
                                                    <div class="flex items-center gap-2 text-xs text-gray-500">
                                                        <span>${odds.decimal}</span>
                                                        <span>${odds.american}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        async function updateOpportunities() {
            const sportKey = document.getElementById('sportSelect').value;
            let events = [];

            try {
                if (sportKey === 'all') {
                    events = await fetchAllSportsOdds();
                } else {
                    events = await fetchOdds(sportKey);
                }

                // Filter events based on selected bookmakers
                events = events.filter(event => {
                    if (!event.bookmakers) return false;
                    return event.bookmakers.some(b => selectedBookmakers.has(b.title));
                });

                opportunities = findArbitrageOpportunities(events);
                displayOpportunities();
            } catch (error) {
                console.error('Error updating opportunities:', error);
                document.getElementById('opportunities').innerHTML = `
                    <div class="text-center text-red-500 py-4">
                        Error updating opportunities: ${error.message}
                    </div>
                `;
            }
        }

        // Update the initialization section
        function startAutoRefresh() {
            // Clear any existing interval
            if (window.refreshInterval) {
                clearInterval(window.refreshInterval);
            }
            // Start a new refresh interval
            window.refreshInterval = setInterval(updateOpportunities, 60000);
            // Update immediately
            updateOpportunities();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing...');
            // Load saved bookmakers first
            loadSavedBookmakers();
            
            // Then fetch sports and start auto-refresh
            fetchSports().then(() => {
                console.log('Sports fetched, starting auto-refresh...');
                // Set initial sport selection to 'all'
                document.getElementById('sportSelect').value = 'all';
                // Update opportunities immediately
                updateOpportunities();
                startAutoRefresh();
            }).catch(error => {
                console.error('Error during initialization:', error);
            });
        });

        document.getElementById('sportSelect').addEventListener('change', () => {
            console.log('Sport changed, restarting auto-refresh...');
            startAutoRefresh();
        });

        document.getElementById('minReturn').addEventListener('change', () => {
            console.log('Min return changed, updating display...');
            displayOpportunities();
        });
        
        document.getElementById('maxStake').addEventListener('change', () => {
            console.log('Max stake changed, updating display...');
            displayOpportunities();
        });
        
        document.getElementById('sortSelect').addEventListener('change', () => {
            console.log('Sort option changed, updating display...');
            displayOpportunities();
        });

        document.getElementById('autoRefresh').addEventListener('change', function() {
            console.log('Auto refresh toggled:', this.checked);
            if (this.checked) {
                startAutoRefresh();
            } else {
                clearInterval(window.refreshInterval);
            }
        });

        // Add event listener for profit filter
        document.getElementById('minProfit').addEventListener('change', () => {
            console.log('Min profit changed, updating display...');
            displayOpportunities();
        });

        // Update styles for better mobile display
        const style = document.createElement('style');
        style.textContent = `
            @media (max-width: 768px) {
                .card { @apply p-4; }
                body { @apply p-4; }
                .text-3xl { @apply text-2xl; }
                #opportunities .border { @apply p-3; }
                .space-y-4 > * { @apply mb-3; }
                .settings-grid {
                    grid-template-columns: 1fr;
                }
            }
        `;
        document.head.appendChild(style);

        function calculateArbitrage() {
            let odds1 = parseFloat(document.getElementById('odds1').value);
            let odds2 = parseFloat(document.getElementById('odds2').value);
            const totalStake = parseFloat(document.getElementById('calcStake').value);

            if (!odds1 || !odds2 || !totalStake) {
                document.getElementById('totalStakeDisplay').textContent = '$0.00';
                document.getElementById('totalPayoutDisplay').textContent = '$0.00';
                document.getElementById('profitDisplay').textContent = '$0.00 (0.00%)';
                return;
            }

            // Convert American odds to decimal
            const decimal1 = odds1 > 0 ? (odds1 / 100) + 1 : (100 / Math.abs(odds1)) + 1;
            const decimal2 = odds2 > 0 ? (odds2 / 100) + 1 : (100 / Math.abs(odds2)) + 1;

            const prob1 = 1 / decimal1;
            const prob2 = 1 / decimal2;
            const totalProb = prob1 + prob2;
            
            if (totalProb >= 1) {
                const margin = ((totalProb - 1) * 100).toFixed(2);
                document.getElementById('totalStakeDisplay').textContent = '$0.00';
                document.getElementById('totalPayoutDisplay').textContent = '$0.00';
                document.getElementById('profitDisplay').textContent = `No arbitrage (${margin}% margin)`;
                return;
            }

            const profit = ((1 / totalProb) - 1) * 100;
            const stake1 = Math.round((totalStake * prob1 / totalProb) * 100) / 100;
            const stake2 = Math.round((totalStake * prob2 / totalProb) * 100) / 100;
            const returns = (stake1 * decimal1).toFixed(2);
            const profitAmount = (returns - totalStake).toFixed(2);

            document.getElementById('totalStakeDisplay').textContent = `$${totalStake.toFixed(2)}`;
            document.getElementById('totalPayoutDisplay').textContent = `$${returns}`;
            document.getElementById('profitDisplay').textContent = `$${profitAmount} (${profit.toFixed(2)}%)`;
        }

        // Add event listeners for calculator inputs
        ['odds1', 'odds2', 'calcStake'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateArbitrage);
        });
    </script>
</body>
</html> 